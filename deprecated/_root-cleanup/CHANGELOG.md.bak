# Changelog — IW8 – WA Click Tracker

> Formato inspirado no [Keep a Changelog](https://keepachangelog.com/pt-BR/1.0.0/) e em [SemVer](https://semver.org/lang/pt-BR/).

## [1.4.0] — 2025-08-29
### Adicionado
- **API REST** com endpoints **`/ping`** e **`/clicks`**.
- **Autenticação** via header **`X-IW8-Token`** (token por domínio).
- **Paginação por cursor (forward-only)** com **`next_cursor`** e cabeçalho **`X-Cursor-Semantics: forward-only`**.
- **Rate limit: 60 rpm** por token, com cabeçalhos **`X-RateLimit-Limit`**, **`X-RateLimit-Remaining`**, **`X-RateLimit-Reset`** e **`Retry-After`** em estouro.
- **Filtros** no `/clicks`: `fields`, `limit`, `since`, `until` (**ISO-8601 UTC**).
- **Cabeçalho de versão de serviço**: **`X-Service-Version: 1.4.0`**.
- **Fallback legado**: leitura de **`{$prefix}wa_clicks`** quando **`{$prefix}iw8_wa_clicks`** não existir.
- **Alias de data**: **`created_at → clicked_at`** (o endpoint sempre retorna `clicked_at`).
- **PUC v5**: monitoramento da branch **`main`** e **`enableReleaseAssets()`** habilitado.
- **Migrações**: `register_activation_hook()` + `admin_init` chamando `iw8_wa_run_migrations()`; suporte a execução via **WP‑CLI**:
  ```bash
  wp eval 'iw8_wa_run_migrations(); echo "ok
";'
  ```
- **Documentação**: README atualizado com contratos da API, segurança, rate limit, cursor, exemplos cURL e troubleshooting.

### Alterado
- **Update URI** no cabeçalho do plugin apontando para o repositório GitHub correto.
- **Empacotamento**: `vendor/` **versionado**; `dist/` **ignorado** (para compatibilidade com PUC/ZIP).
- **Validação de parâmetros** nos endpoints (erros 4xx mais claros).

### Segurança
- **HTTPS obrigatório em produção** (requisições HTTP são recusadas com **401**).
- Observação para **WAF/CDN** (ex.: Cloudflare): liberar **`/wp-json/iw8-wa/*`** se houver bloqueios.

### Notas de Upgrade
1. **Defina o token do domínio**:
   ```bash
   wp option update iw8_wa_domain_token "SEU_TOKEN_FORTE"
   # Gerar um token forte:
   wp eval 'echo bin2hex(random_bytes(32)).PHP_EOL;'
   ```
2. Garanta **`vendor/`** presente (versionado neste repositório).
3. Atualize para **1.4.0** via **WP‑Admin → Dashboard → Updates → Check again**.
4. O primeiro acesso ao **WP‑Admin** dispara as **migrações** (se necessário). Alternativa: WP‑CLI (comando acima).
5. **Teste os endpoints** (via HTTPS):
   ```bash
   curl -sS https://seusite.com/wp-json/iw8-wa/v1/ping -H "X-IW8-Token: SEU_TOKEN"
   curl -sS "https://seusite.com/wp-json/iw8-wa/v1/clicks?fields=id,clicked_at,page_url&limit=2" -H "X-IW8-Token: SEU_TOKEN"
   ```

### Compatibilidade
- Em sites com dados **1.3.x**, o `/clicks` retorna itens usando o **fallback** para `wa_clicks` quando a tabela nova não existe, mantendo **`clicked_at`** presente (via alias).

### Conhecidas / Observações
- **Todos os horários** na API são **UTC** (ISO‑8601 com `Z`). Ajuste o consumo no cliente se precisar de timezone local.
- O **rate limit (60 rpm)** pode ser ajustado em releases futuras conforme telemetria.

---

## Histórico anterior
- 1.3.x — Exportação CSV, melhorias de admin e preparação para auto‑update via GitHub (PUC).
- Para detalhes legados, consulte as notas das versões 1.3.x no repositório.

